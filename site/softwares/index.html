<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Softwares - Alignment</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Softwares";
        var mkdocs_page_input_path = "softwares.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Alignment
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../intro/">Introduction</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Softwares</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#bwa_mem">bwa_mem</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#bwa_mem_merge">bwa_mem_merge</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_1">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_1">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_1">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_1">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_1">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#bwa_mem_realign_consensus_reads">bwa_mem_realign_consensus_reads</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_2">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_2">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_2">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_2">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_2">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fgbio_call_and_filter_consensus_reads">fgbio_call_and_filter_consensus_reads</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_3">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_3">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_3">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_3">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_3">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fgbio_group_reads_by_umi">fgbio_group_reads_by_umi</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_4">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_4">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_4">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_4">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_4">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fgbio_copy_umi_from_read_name">fgbio_copy_umi_from_read_name</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_5">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_5">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_5">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_5">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_5">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#hifiasm">hifiasm</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_6">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_6">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_6">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_6">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_6">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#minimap2">minimap2</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_7">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_7">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_7">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_7">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_7">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#minimap2_merge">minimap2_merge</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_8">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_8">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_8">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_8">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_8">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#pbmm2_align">pbmm2_align</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_9">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_9">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_9">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_9">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_9">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#picard-mark-duplicates">picard mark duplicates</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_10">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_10">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_10">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_10">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_10">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#picard_mark_duplicates_non_chr">picard_mark_duplicates_non_chr</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_11">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_11">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_11">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_11">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_11">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#samtools_extract_reads">samtools_extract_reads</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_12">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_12">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_12">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_12">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_12">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#samtools_extract_reads_non_chr">samtools_extract_reads_non_chr</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_13">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_13">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_13">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_13">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_13">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#samtools_extract_reads_umi">samtools_extract_reads_umi</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_14">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_14">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_14">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_14">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_14">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#samtools_extract_reads_non_chr_umi">samtools_extract_reads_non_chr_umi</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_15">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_15">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_15">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_15">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_15">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#samtools_fastq">samtools_fastq</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_16">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_16">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_16">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_16">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_16">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#samtools-index">samtools index</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_17">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_17">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_17">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_17">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_17">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#samtools_merge_bam">samtools_merge_bam</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_18">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_18">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_18">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_18">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_18">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#samtools-sort">samtools sort</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_19">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_19">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_19">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_19">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_19">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#samtools-sort_umi">samtools sort_umi</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_20">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_20">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_20">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_20">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_20">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#star">star</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#rule_21">Rule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#input-output-files_21">input / output files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration_21">Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#software-settings-configyaml_21">Software settings (config.yaml)</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-settings-resourcesyaml_21">Resources settings (resources.yaml)</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Alignment</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Softwares</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="softwares-used-in-the-alignment-module">Softwares used in the alignment module</h1>
<h2 id="bwa_mem"><a href="https://github.com/lh3/bwa">bwa_mem</a></h2>
<p>Align <code>.fastq</code> files to a reference genome and generate a <code>.bam</code> file.</p>
<h3 id="rule"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule bwa_mem:
    input:
        reads=lambda wildcards: alignment_input(wildcards),
        idx=[
            config.get(&quot;bwa_mem&quot;, {}).get(&quot;amb&quot;, &quot;&quot;),
            config.get(&quot;bwa_mem&quot;, {}).get(&quot;ann&quot;, &quot;&quot;),
            config.get(&quot;bwa_mem&quot;, {}).get(&quot;bwt&quot;, &quot;&quot;),
            config.get(&quot;bwa_mem&quot;, {}).get(&quot;pac&quot;, &quot;&quot;),
            config.get(&quot;bwa_mem&quot;, {}).get(&quot;sa&quot;, &quot;&quot;),
        ],
    output:
        bam=temp(&quot;alignment/bwa_mem/{sample}_{type}_{flowcell}_{lane}_{barcode}.bam&quot;),
    params:
        extra=lambda wildcards: &quot;%s %s %s&quot;
        % (
            config.get(&quot;bwa_mem&quot;, {}).get(&quot;extra&quot;, &quot;&quot;),
            config.get(&quot;bwa_mem&quot;, {}).get(&quot;read_group&quot;, generate_read_group(wildcards)),
            get_deduplication_option(wildcards),
        ),
        sorting=config.get(&quot;bwa_mem&quot;, {}).get(&quot;sort&quot;, &quot;samtools&quot;),
        sort_order=config.get(&quot;bwa_mem&quot;, {}).get(&quot;sort_order&quot;, &quot;coordinate&quot;),
        sort_extra=&quot;-@ %s&quot;
        % str(config.get(&quot;bwa_mem&quot;, config[&quot;default_resources&quot;]).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])),
    log:
        &quot;alignment/bwa_mem/{sample}_{type}_{flowcell}_{lane}_{barcode}.bam.log&quot;,
    benchmark:
        repeat(
            &quot;alignment/bwa_mem/{sample}_{type}_{flowcell}_{lane}_{barcode}.bam.benchmark.tsv&quot;,
            config.get(&quot;bwa_mem&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;bwa_mem&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;bwa_mem&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;bwa_mem&quot;, {}).get(&quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]),
        partition=config.get(&quot;bwa_mem&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;bwa_mem&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;bwa_mem&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;bwa_mem&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: align fastq files {input.reads} using bwa mem against {input.idx[2]}&quot;
    wrapper:
        &quot;v1.3.1/bio/bwa/mem&quot;
</code></pre>
<h4 id="input-output-files"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="2" style="vertical-align:top;">input</td>
<td>reads</td>
<td><code>lambda wildcards: alignment_input(wildcards)</code></td>
<td>fastq files from the same sample.<br />fastq files obtained by get_fastq_file defined in <a href="https://github.com/hydra-genetics/prealignment/blob/develop/workflow/rules/common.smk"><code>common.smk</code></a><br /></td>
</tr>
<tr>
<td>idx</td>
<td><code>[ config.get("bwa_mem", {}).get("amb", ""), config.get("bwa_mem", {}).get("ann", ""), config.get("bwa_mem", {}).get("bwt", ""), config.get("bwa_mem", {}).get("pac", ""), config.get("bwa_mem", {}).get("sa", ""), ]</code></td>
<td>reference files for bwa-mem, location are defined in the <code>config.yaml</code><br /></td>
</tr>
<tr>
<td>output</td>
<td>bam</td>
<td><code>"alignment/bwa_mem/{sample}_{type}_{flowcell}_{lane}_{barcode}.bam"</code></td>
<td>aligned bam file.<br />NOTE: if the fastq files are divided into different lanes for the same sample,<br />they will be aligned separately<br /></td>
</tr>
</tbody>
</table>
<h3 id="configuration"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>Parameters that should be forwarded.<br /><strong>NOTE:</strong> If the sample is marked with umi in the deduplication column in the samples.tsv file the -Y flag is added by the get_deduplication_option function (in common.smk)<br /></td>
</tr>
<tr>
<td>read_group</td>
<td>string</td>
<td>RG string will be added to bam file generated.<br />The RG string is generated by the function generate_read_group defined in <a href="https://github.com/hydra-genetics/alignment/blob/develop/workflow/rules/common.smk"><code>common.smk</code></a><br /></td>
</tr>
<tr>
<td>sorting</td>
<td>string</td>
<td>program handling the bam sorting (default samtools)</td>
</tr>
<tr>
<td>sort_order</td>
<td>string</td>
<td>how the bam file should be sorted (default coordinate)</td>
</tr>
<tr>
<td>sort_extra</td>
<td>string</td>
<td>parameters that should be forwarded to sorting (ie, number of threads)</td>
</tr>
<tr>
<td>amb</td>
<td>string</td>
<td>fasta reference amb file</td>
</tr>
<tr>
<td>ann</td>
<td>string</td>
<td>fasta reference ann file</td>
</tr>
<tr>
<td>bwt</td>
<td>string</td>
<td>fasta reference bwt file</td>
</tr>
<tr>
<td>pac</td>
<td>string</td>
<td>fasta reference pac file</td>
</tr>
<tr>
<td>sa</td>
<td>string</td>
<td>fasta reference sa file</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>memory in MB used per cpu<br /><strong>NOTE:</strong> bwa mem uses a large amount of memory.<br /></td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory used per cpu<br /><strong>NOTE:</strong> bwa mem uses a large amount of memory.<br /></td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available<br /><strong>RECOMMENDATION:</strong> use multiple threads for decreased run time.<br /><strong>NOTE:</strong> if multiple threads is used the memory must also be increased (mem_mb)<br /></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="bwa_mem_merge"><a href="http://www.htslib.org/doc/samtools-merge.html">bwa_mem_merge</a></h2>
<p>Merge <code>.bam</code> files from the same sample using samtools merge.</p>
<h3 id="rule_1"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule bwa_mem_merge:
    input:
        bams=lambda wildcards: [
            &quot;alignment/bwa_mem/{sample}_{type}_%s_%s_%s.bam&quot; % (u.flowcell, u.lane, u.barcode)
            for u in get_units(units, wildcards)
        ],
    output:
        bam=temp(&quot;alignment/bwa_mem/{sample}_{type}_unsorted.bam&quot;),
    params:
        config.get(&quot;bwa_mem_merge&quot;, {}).get(&quot;extra&quot;, &quot;&quot;),
    log:
        &quot;alignment/bwa_mem/{sample}_{type}_unsorted.bam.log&quot;,
    benchmark:
        repeat(
            &quot;alignment/bwa_mem/{sample}_{type}_unsorted.bam.benchmark.tsv&quot;,
            config.get(&quot;bwa_mem_merge&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;bwa_mem_merge&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;bwa_mem_merge&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;bwa_mem_merge&quot;, {}).get(&quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]),
        partition=config.get(&quot;bwa_mem_merge&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;bwa_mem_merge&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;bwa_mem_merge&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;bwa_mem_merge&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: merge bam file {input} using samtools&quot;
    wrapper:
        &quot;v1.1.0/bio/samtools/merge&quot;
</code></pre>
<h4 id="input-output-files_1"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>bams</td>
<td><code>lambda wildcards: [ "alignment/bwa_mem/{sample}_{type}_%s_%s_%s.bam" % (u.flowcell, u.lane, u.barcode) for u in get_units(units, wildcards) ]</code></td>
<td>bam files from the same sample (and the same sample type)<br />a list of bam files is obtained using the information in the <code>units.tsv</code> file<br /></td>
</tr>
<tr>
<td>output</td>
<td>bam</td>
<td><code>"alignment/bwa_mem/{sample}_{type}_unsorted.bam"</code></td>
<td>an unsorted merged bam file</td>
</tr>
</tbody>
</table>
<h3 id="configuration_1"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_1">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded<br /><strong>RECOMMENDATION:</strong> use -c -p to only keep one of the read groups IDs when merging files from the same sample<br /></td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_1">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="bwa_mem_realign_consensus_reads"><a href="https://github.com/lh3/bwa">bwa_mem_realign_consensus_reads</a></h2>
<p>Realign after consensus read creation by fgbio_call_and_filter_consensus_reads and generate a <code>.bam</code> file.</p>
<h3 id="rule_2"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule bwa_mem_realign_consensus_reads:
    input:
        bam=&quot;alignment/fgbio_call_and_filter_consensus_reads/{sample}_{type}.umi.unmapped_bam&quot;,
    output:
        bam=temp(&quot;alignment/bwa_mem_realign_consensus_reads/{sample}_{type}.umi_unsorted.bam&quot;),
    params:
        extra_bwa_mem=config.get(&quot;bwa_mem_realign_consensus_reads&quot;, {}).get(&quot;extra_bwa_mem&quot;, &quot;&quot;),
        extra_sort=config.get(&quot;bwa_mem_realign_consensus_reads&quot;, {}).get(&quot;extra_sort&quot;, &quot;&quot;),
        extra_zipper_bam=config.get(&quot;bwa_mem_realign_consensus_reads&quot;, {}).get(&quot;extra_zipper_bam&quot;, &quot;&quot;),
        reference=config.get(&quot;reference&quot;, {}).get(&quot;fasta&quot;, &quot;&quot;),
    log:
        &quot;alignment/bwa_mem_realign_consensus_reads/{sample}_{type}.umi.bam.log&quot;,
    benchmark:
        repeat(
            &quot;alignment/bwa_mem_realign_consensus_reads/{sample}_{type}.umi.bam.benchmark.tsv&quot;,
            config.get(&quot;bwa_mem_realign_consensus_reads&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;bwa_mem_realign_consensus_reads&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;bwa_mem_realign_consensus_reads&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;bwa_mem_realign_consensus_reads&quot;, {}).get(
            &quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]
        ),
        partition=config.get(&quot;bwa_mem_realign_consensus_reads&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;bwa_mem_realign_consensus_reads&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;bwa_mem_realign_consensus_reads&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;bwa_mem_realign_consensus_reads&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: realign unmappend consensus reads found in {input.bam}&quot;
    shell:
        'sh -c &quot;'
        &quot;samtools fastq {input.bam} &quot;
        &quot;| bwa mem &quot;
        &quot;-t {threads} &quot;
        &quot;-p &quot;
        &quot;-K 150000000 &quot;
        &quot;-Y &quot;
        &quot;{params.reference} &quot;
        &quot;{params.extra_bwa_mem} - &quot;
        &quot;| fgbio -Xmx4g --compression 1 --async-io ZipperBams &quot;
        &quot;--unmapped {input.bam} &quot;
        &quot;--ref {params.reference} &quot;
        &quot;--tags-to-reverse Consensus &quot;
        &quot;--tags-to-revcomp Consensus &quot;
        &quot; -o {output.bam} &quot;
        '{params.extra_zipper_bam} &quot; &gt;&amp; {log}'
</code></pre>
<h4 id="input-output-files_2"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>bam</td>
<td><code>"alignment/fgbio_call_and_filter_consensus_reads/{sample}_{type}.umi.unmapped_bam"</code></td>
<td>unmapped <code>bam</code> file with consensus reads based on umi barcodes</td>
</tr>
<tr>
<td>output</td>
<td>bam</td>
<td><code>"alignment/bwa_mem_realign_consensus_reads/{sample}_{type}.umi_unsorted.bam"</code></td>
<td>realigned and sorted <code>bam</code> file based on umi consensus reads</td>
</tr>
</tbody>
</table>
<h3 id="configuration_2"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_2">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra_bwa_mem</td>
<td>string</td>
<td>parameters that should be forwarded to bwa_mem</td>
</tr>
<tr>
<td>extra_sort</td>
<td>string</td>
<td>parameters that should be forwarded to samtools sort</td>
</tr>
<tr>
<td>extra_zipper_bam</td>
<td>string</td>
<td>parameters that should be forwarded to fgbios ZipperBam</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_2">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>max memory in MB to be available</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available<br /><strong>RECOMMENDATION:</strong> Use multiple threads for decreased run time.<br /><strong>NOTE:</strong> If multiple threads is used the memory must also be increased (mem_mb)<br /></td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="fgbio_call_and_filter_consensus_reads"><a href="http://fulcrumgenomics.github.io/fgbio/tools/latest/">fgbio_call_and_filter_consensus_reads</a></h2>
<p>Call and filter consensus reads based on umis using fgbio (CallDuplexConsensusReads followed by FilterConsensusReads)</p>
<h3 id="rule_3"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule fgbio_call_and_filter_consensus_reads:
    input:
        bam=&quot;alignment/fgbio_group_reads_by_umi/{sample}_{type}.umi.bam&quot;,
    output:
        bam=temp(&quot;alignment/fgbio_call_and_filter_consensus_reads/{sample}_{type}.umi.unmapped_bam&quot;),
    params:
        extra_call=config.get(&quot;fgbio_call_and_filter_consensus_reads&quot;, {}).get(&quot;extra_call&quot;, &quot;&quot;),
        extra_filter=config.get(&quot;fgbio_call_and_filter_consensus_reads&quot;, {}).get(&quot;extra_filter&quot;, &quot;&quot;),
        max_base_error_rate=config.get(&quot;fgbio_call_and_filter_consensus_reads&quot;, {}).get(&quot;max_base_error_rate&quot;, &quot;0.2&quot;),
        min_reads_call=config.get(&quot;fgbio_call_and_filter_consensus_reads&quot;, {}).get(&quot;min_reads_call&quot;, &quot;1 1 1&quot;),
        min_reads_filter=config.get(&quot;fgbio_call_and_filter_consensus_reads&quot;, {}).get(&quot;min_reads_filter&quot;, &quot;1 1 1&quot;),
        min_input_base_quality_call=config.get(&quot;fgbio_call_and_filter_consensus_reads&quot;, {}).get(
            &quot;min_input_base_quality_call&quot;, &quot;20&quot;
        ),
        min_input_base_quality_filter=config.get(&quot;fgbio_call_and_filter_consensus_reads&quot;, {}).get(
            &quot;min_input_base_quality_filter&quot;, &quot;45&quot;
        ),
        reference=config.get(&quot;reference&quot;, {}).get(&quot;fasta&quot;, &quot;&quot;),
    log:
        &quot;alignment/fgbio_call_and_filter_consensus_reads/{sample}_{type}.umi.unmapped.bam.log&quot;,
    benchmark:
        repeat(
            &quot;alignment/fgbio_call_and_filter_consensus_reads/{sample}_{type}.umi.unmapped.bam.benchmark.tsv&quot;,
            config.get(&quot;fgbio_call_and_filter_consensus_reads&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;fgbio_call_and_filter_consensus_reads&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;fgbio_call_and_filter_consensus_reads&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;fgbio_call_and_filter_consensus_reads&quot;, {}).get(
            &quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]
        ),
        partition=config.get(&quot;fgbio_call_and_filter_consensus_reads&quot;, {}).get(
            &quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]
        ),
        threads=config.get(&quot;fgbio_call_and_filter_consensus_reads&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;fgbio_call_and_filter_consensus_reads&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;fgbio_call_and_filter_consensus_reads&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: call and filter consensus reads in {input.bam} into an unmapped bam file&quot;
    shell:
        'sh -c &quot;'
        &quot;fgbio -Xmx4g --compression 0 CallDuplexConsensusReads &quot;
        &quot;--input {input.bam} &quot;
        &quot;--output /dev/stdout &quot;
        &quot;--min-reads {params.min_reads_call} &quot;
        &quot;--min-input-base-quality {params.min_input_base_quality_call} &quot;
        &quot;--threads {threads} &quot;
        &quot;{params.extra_call} &quot;
        &quot;| fgbio -Xmx8g --compression 1 FilterConsensusReads &quot;
        &quot;--input /dev/stdin &quot;
        &quot;--output {output.bam} &quot;
        &quot;--ref {params.reference} &quot;
        &quot;--min-reads {params.min_reads_filter} &quot;
        &quot;--min-base-quality {params.min_input_base_quality_filter} &quot;
        &quot;--max-base-error-rate {params.max_base_error_rate} &quot;
        '{params.extra_filter}&quot; &gt;&amp; {log}'
</code></pre>
<h4 id="input-output-files_3"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>bam</td>
<td><code>"alignment/fgbio_group_reads_by_umi/{sample}_{type}.umi.bam"</code></td>
<td>input 'bam' file with umi tags</td>
</tr>
<tr>
<td>output</td>
<td>bam</td>
<td><code>"alignment/fgbio_call_and_filter_consensus_reads/{sample}_{type}.umi.unmapped_bam"</code></td>
<td>unmapped <code>bam</code> file with consensus reads that are hard filtered</td>
</tr>
</tbody>
</table>
<h3 id="configuration_3"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_3">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra_call</td>
<td>string</td>
<td>parameters that should be forwarded to CallDuplexConsensusReads</td>
</tr>
<tr>
<td>extra_filter</td>
<td>string</td>
<td>parameters that should be forwarded to FilterConsensusReads</td>
</tr>
<tr>
<td>max_base_error_rate</td>
<td>string</td>
<td>mask bases with N if the % of reads that differ from consensus in higher than max error rate in FilterConsensusReads</td>
</tr>
<tr>
<td>min_reads_call</td>
<td>string</td>
<td>String of three numbers for which the reads are filtered if the number of reads are under these numbers in CallDuplexConsensusReads.<br />The first number is reads from both strands while the second and third number is for the individual strands. <br />The first number must be greater or equal to the other numbers.<br /></td>
</tr>
<tr>
<td>min_reads_filter</td>
<td>string</td>
<td>String of three numbers for which the reads are filtered if the number of reads are under these numbers in FilterConsensusReads.<br />The first number is reads from both strands while the second and third number is for the individual strands. <br />The first number must be greater or equal to the other numbers.<br /></td>
</tr>
<tr>
<td>min_input_base_quality_call</td>
<td>integer</td>
<td>only consider bases over min base quality in consensus creation in CallDuplexConsensusReads</td>
</tr>
<tr>
<td>min_input_base_quality_filter</td>
<td>integer</td>
<td>mask bases with N if under min base quality in consensus creation in FilterConsensusReads</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_3">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>max memory in MB to be available<br /><strong>NOTE:</strong> must be at least 8 GB<br /></td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available<br /><strong>RECOMMENDATION:</strong> Use multiple threads for decreased run time.<br /></td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="fgbio_group_reads_by_umi"><a href="http://fulcrumgenomics.github.io/fgbio/tools/latest/GroupReadsByUmi.html">fgbio_group_reads_by_umi</a></h2>
<p>Group and sort reads based on umi using fgbio in preparation for fgbio_call_and_filter_consensus_reads. Also add mate pair MQ sam tags using samblaster.</p>
<h3 id="rule_4"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule fgbio_group_reads_by_umi:
    input:
        bam=&quot;alignment/fgbio_copy_umi_from_read_name/{sample}_{type}.umi.bam&quot;,
    output:
        bam=&quot;alignment/fgbio_group_reads_by_umi/{sample}_{type}.umi.bam&quot;,
        histo=&quot;alignment/fgbio_group_reads_by_umi/{sample}_{type}.umi.histo.tsv&quot;,
    params:
        extra=config.get(&quot;fgbio_group_reads_by_umi&quot;, {}).get(&quot;extra&quot;, &quot;&quot;),
        umi_strategy=config.get(&quot;fgbio_group_reads_by_umi&quot;, {}).get(&quot;umi_strategy&quot;, &quot;paired&quot;),
    log:
        &quot;alignment/fgbio_group_reads_by_umi/{sample}_{type}.umi.bam.log&quot;,
    benchmark:
        repeat(
            &quot;alignment/fgbio_group_reads_by_umi/{sample}_{type}.umi.bam.benchmark.tsv&quot;,
            config.get(&quot;fgbio_group_reads_by_umi&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;fgbio_group_reads_by_umi&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;fgbio_group_reads_by_umi&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;fgbio_group_reads_by_umi&quot;, {}).get(&quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]),
        partition=config.get(&quot;fgbio_group_reads_by_umi&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;fgbio_group_reads_by_umi&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;fgbio_group_reads_by_umi&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;fgbio_group_reads_by_umi&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: group reads by umi in {input.bam} and output umi sorted bam&quot;
    shell:
        &quot;(fgbio GroupReadsByUmi &quot;
        &quot;-i {input.bam} &quot;
        &quot;-o {output.bam} &quot;
        &quot;-f {output.histo} &quot;
        &quot;-s {params.umi_strategy} &quot;
        &quot;{params.extra}) &amp;&gt; {log}&quot;
</code></pre>
<h4 id="input-output-files_4"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>bam</td>
<td><code>"alignment/fgbio_copy_umi_from_read_name/{sample}_{type}.umi.bam"</code></td>
<td>input bam file</td>
</tr>
<tr>
<td>output</td>
<td>bam</td>
<td><code>"alignment/fgbio_group_reads_by_umi/{sample}_{type}.umi.bam"</code></td>
<td>output bam that is umi sorted</td>
</tr>
</tbody>
</table>
<h3 id="configuration_4"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_4">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded</td>
</tr>
<tr>
<td>umi_strategy</td>
<td>string</td>
<td>umi strategy for how the umis should be grouped (paired for duplex umis)</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_4">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>max memory in MB to be available</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="fgbio_copy_umi_from_read_name"><a href="http://fulcrumgenomics.github.io/fgbio/tools/latest/CopyUmiFromReadName.html">fgbio_copy_umi_from_read_name</a></h2>
<p>Copies the UMI at the end of the BAM’s read name to the RX tag using fgbio in preparation for fgbio_group_reads_by_umi</p>
<h3 id="rule_5"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule fgbio_copy_umi_from_read_name:
    input:
        bam=&quot;alignment/bwa_mem/{sample}_{type}.umi.bam&quot;,
    output:
        bam=temp(&quot;alignment/fgbio_copy_umi_from_read_name/{sample}_{type}.umi.bam&quot;),
    params:
        extra=config.get(&quot;fgbio_copy_umi_from_read_name&quot;, {}).get(&quot;extra&quot;, &quot;&quot;),
    log:
        &quot;alignment/fgbio_copy_umi_from_read_name/{sample}_{type}.umi.bam.log&quot;,
    benchmark:
        repeat(
            &quot;alignment/fgbio_copy_umi_from_read_name/{sample}_{type}.umi.bam.benchmark.tsv&quot;,
            config.get(&quot;fgbio_copy_umi_from_read_name&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;fgbio_copy_umi_from_read_name&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;fgbio_copy_umi_from_read_name&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;fgbio_copy_umi_from_read_name&quot;, {}).get(&quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]),
        partition=config.get(&quot;fgbio_copy_umi_from_read_name&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;fgbio_copy_umi_from_read_name&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;fgbio_copy_umi_from_read_name&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;fgbio_copy_umi_from_read_name&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: Copy UMI from read name to sam tag on {input.bam}&quot;
    shell:
        'sh -c &quot;'
        &quot;(samtools view &quot;
        &quot;-h &quot;
        &quot;-f 0x2 &quot;
        &quot;{input.bam} &quot;
        &quot;| samblaster &quot;
        &quot;--addMateTags &quot;
        &quot;--ignoreUnmated &quot;
        &quot;| fgbio CopyUmiFromReadName &quot;
        &quot;-i /dev/stdin &quot;
        &quot;-o {output.bam} &quot;
        '{params.extra})&quot; &amp;&gt; {log}'
</code></pre>
<h4 id="input-output-files_5"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>bam</td>
<td><code>"alignment/bwa_mem/{sample}_{type}.umi.bam"</code></td>
<td>input <code>bam</code> file</td>
</tr>
<tr>
<td>output</td>
<td>bam</td>
<td><code>"alignment/fgbio_copy_umi_from_read_name/{sample}_{type}.umi.bam"</code></td>
<td>Output <code>bam</code> file with umi tag added (default tag name RX) extracted from the read name</td>
</tr>
</tbody>
</table>
<h3 id="configuration_5"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_5">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_5">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>max memory in MB to be available</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available<br /><strong>RECOMMENDATION:</strong> Use multiple threads for decreased run time.<br /></td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="hifiasm"><a href="https://github.com/chhylp123/hifiasm">hifiasm</a></h2>
<p>Introduction to hifiasm</p>
<h3 id="rule_6"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule hifiasm:
    input:
        fasta=[&quot;long_read/hifiasm/{sample}_{type}_{processing_unit}_{barcode}.s2fq.fastq.gz&quot;],
    # optional
    output:
        #&quot;long_read/hifiasm/{sample}_{type}_{processing_unit}_{barcode}.a_ctg.gfa&quot;,
        outputlist=multiext(
            &quot;long_read/hifiasm/{sample}_{type}_{processing_unit}_{barcode}.&quot;,
            &quot;a_ctg.gfa&quot;,
            &quot;a_ctg.lowQ.bed&quot;,
            &quot;a_ctg.noseq.gfa&quot;,
            &quot;p_ctg.gfa&quot;,
            &quot;p_ctg.lowQ.bed&quot;,
            &quot;p_ctg.noseq.gfa&quot;,
            &quot;p_utg.gfa&quot;,
            &quot;p_utg.lowQ.bed&quot;,
            &quot;p_utg.noseq.gfa&quot;,
            &quot;r_utg.gfa&quot;,
            &quot;r_utg.lowQ.bed&quot;,
            &quot;r_utg.noseq.gfa&quot;,
        ),
    log:
        &quot;long_read/hifiasm/{sample}_{type}_{processing_unit}_{barcode}.log&quot;,
    container:
        config.get(&quot;hifiasm&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    params:
        extra=&quot;--primary -f 37 -l 1 -s 0.75 -O 1&quot;,
    threads: config.get(&quot;hifiasm&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        partition=config.get(&quot;hifiasm&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        time=config.get(&quot;hifiasm&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
        mem_per_cpu=config.get(&quot;hifiasm&quot;, {}).get(&quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]),
        threads=config.get(&quot;hifiasm&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
    wrapper:
        # &quot;file:///beegfs-storage/projects/wp3/nobackup/Workspace/magz_testing/snakemake-wrappers/bio/hifiasm&quot;
        &quot;v3.3.6/bio/hifiasm&quot;


# Dervied from https://snakemake-wrappers.readthedocs.io/en/stable/wrappers/hifiasm.html
</code></pre>
<h4 id="input-output-files_6"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>fasta</td>
<td><code>["long_read/hifiasm/{sample}_{type}_{processing_unit}_{barcode}.s2fq.fastq.gz"]</code></td>
<td>genome reference fasta file</td>
</tr>
<tr>
<td>output</td>
<td>outputlist</td>
<td><code>multiext( "long_read/hifiasm/{sample}_{type}_{processing_unit}_{barcode}.", "a_ctg.gfa", "a_ctg.lowQ.bed", "a_ctg.noseq.gfa", "p_ctg.gfa", "p_ctg.lowQ.bed", "p_ctg.noseq.gfa", "p_utg.gfa", "p_utg.lowQ.bed", "p_utg.noseq.gfa", "r_utg.gfa", "r_utg.lowQ.bed", "r_utg.noseq.gfa", )</code></td>
<td>list of a range of outputfiles produced</td>
</tr>
</tbody>
</table>
<h3 id="configuration_6"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_6">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_6">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>max memory in MB to be available</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="minimap2"><a href="https://github.com/lh3/minimap2">minimap2</a></h2>
<p>Align long read sequencing data stored in a <code>bam</code>file to a reference genome to produce a <code>bam</code> with aligned reads.</p>
<h3 id="rule_7"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule minimap2:
    input:
        query=lambda wildcards: get_minimap2_query(wildcards),
        target=config.get(&quot;minimap2&quot;, {}).get(&quot;mmi&quot;, &quot;&quot;),
    output:
        bam=temp(&quot;alignment/minimap2/{sample}_{type}_{processing_unit}_{barcode}.bam&quot;),
    params:
        extra=lambda wildcards, input: &quot;%s %s -x %s&quot;
        % (
            config.get(&quot;minimap2&quot;, {}).get(&quot;extra&quot;, &quot;&quot;),
            config.get(&quot;minimap2&quot;, {}).get(&quot;read_group&quot;, generate_minimap2_read_group(wildcards, input)),
            config.get(&quot;minimap2&quot;, {}).get(&quot;preset&quot;, &quot;map-ont&quot;),
        ),
        sorting=config.get(&quot;minimap2&quot;, {}).get(&quot;sort_order&quot;, &quot;coordinate&quot;),
        sort_extra=config.get(&quot;minimap2&quot;, {}).get(&quot;sort_extra&quot;, &quot;&quot;),
    log:
        &quot;alignment/minimap2/{sample}_{type}_{processing_unit}_{barcode}.bam.log&quot;,
    benchmark:
        repeat(
            &quot;alignment/minimap2/{sample}_{type}_{processing_unit}_{barcode}.bam.benchmark.tsv&quot;,
            config.get(&quot;minimap2&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;minimap2&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;minimap2&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;minimap2&quot;, {}).get(&quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]),
        partition=config.get(&quot;minimap2&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;minimap2&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;minimap2&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;minimap2&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: run minimap2 on {input}&quot;
    wrapper:
        &quot;v3.9.0/bio/minimap2/aligner&quot;
</code></pre>
<h4 id="input-output-files_7"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="2" style="vertical-align:top;">input</td>
<td>target</td>
<td><code>config.get("minimap2", {}).get("mmi", "")</code></td>
<td>a mininmap2 index file for the reference genome</td>
</tr>
<tr>
<td>query</td>
<td><code>lambda wildcards: get_minimap2_query(wildcards)</code></td>
<td>bam file with unaligned reads</td>
</tr>
<tr>
<td>output</td>
<td>bam</td>
<td><code>"alignment/minimap2/{sample}_{type}_{processing_unit}_{barcode}.bam"</code></td>
<td>bam file with unaligned reads (Note that the methylation tags will also be present in the aligned bam file)</td>
</tr>
</tbody>
</table>
<h3 id="configuration_7"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_7">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded</td>
</tr>
<tr>
<td>mmi</td>
<td>string</td>
<td>fasta reference mmi file (generated with the same preset as specified in the config)</td>
</tr>
<tr>
<td>preset</td>
<td>string</td>
<td>minimap2 preset options for various types long read sequencing data (e.g., map-hifi or map-ont)</td>
</tr>
<tr>
<td>read_group</td>
<td>string</td>
<td>RG string will be added to bam file generated.<br />The RG string is generated by the function generate_minimap2_read_group defined in <a href="https://github.com/hydra-genetics/alignment/blob/develop/workflow/rules/common.smk"><code>common.smk</code></a><br /></td>
</tr>
<tr>
<td>sort_order</td>
<td>string</td>
<td>how the bam file should be sorted (default coordinate)</td>
</tr>
<tr>
<td>sort_extra</td>
<td>string</td>
<td>parameters that should be forwarded to sorting (NB. do not set -@ or --threads here, this is set from {threads})</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_7">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>max memory in MB to be available</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="minimap2_merge"><a href="http://www.htslib.org/doc/samtools-merge.html">minimap2_merge</a></h2>
<p>Merge minimap2 <code>.bam</code> files from the same sample using samtools merge.</p>
<h3 id="rule_8"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule minimap2_merge:
    input:
        bams=lambda wildcards: [
            &quot;alignment/minimap2/{sample}_{type}_%s_%s.bam&quot; % (u.processing_unit, u.barcode) for u in get_units(units, wildcards)
        ],
    output:
        bam=temp(&quot;alignment/minimap2/{sample}_{type}_unsorted.bam&quot;),
    params:
        extra=config.get(&quot;minimap2&quot;, {}).get(&quot;extra&quot;, &quot;&quot;),
    log:
        &quot;alignment/minimap2/{sample}_{type}_unsorted.bam.log&quot;,
    benchmark:
        repeat(
            &quot;alignment/minimap2/{sample}_{type}_unsorted.bam.benchmark.tsv&quot;,
            config.get(&quot;minimap2&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;minimap2_merge&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;minimap2_merge&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;minimap2_merge&quot;, {}).get(&quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]),
        partition=config.get(&quot;minimap2_merge&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;minimap2_merge&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;minimap2_merge&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;minimap2_merge&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: merge bam file {input} using samtools&quot;
    wrapper:
        &quot;v3.9.0/bio/samtools/merge&quot;
</code></pre>
<h4 id="input-output-files_8"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>bams</td>
<td><code>lambda wildcards: [ "alignment/minimap2/{sample}_{type}_%s_%s.bam" % (u.processing_unit, u.barcode) for u in get_units(units, wildcards) ]</code></td>
<td>bam files from the same sample (and the same sample type)<br />a list of bam files is obtained using the information in the <code>units.tsv</code> file<br /></td>
</tr>
<tr>
<td>output</td>
<td>bam</td>
<td><code>"alignment/minimap2/{sample}_{type}_unsorted.bam"</code></td>
<td>an unsorted merged bam file</td>
</tr>
</tbody>
</table>
<h3 id="configuration_8"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_8">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded<br /><strong>RECOMMENDATION:</strong> use -c -p to only keep one of the read groups IDs when merging files from the same sample<br /></td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_8">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>max memory in MB to be available</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="pbmm2_align"><a href="url_to_tool">pbmm2_align</a></h2>
<p>Introduction to pbmm2_align</p>
<h3 id="rule_9"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule pbmm2_align:
    input:
        reference=config.get(&quot;pbmm2_align&quot;, {}).get(&quot;index&quot;, &quot;&quot;),
        query=pbmm2_input,
    output:
        bam=&quot;alignment/pbmm2_align/{sample}_{type}_{processing_unit}_{barcode}.pbmm2.bam&quot;,
    params:
        preset=config.get(&quot;pbmm2_align&quot;, {}).get(&quot;preset&quot;, &quot;&quot;),
        sample=lambda wildcards: wildcards.sample,
        loglevel=&quot;INFO&quot;,
        extra=config.get(&quot;pbmm2_align&quot;, {}).get(&quot;extra&quot;, &quot;&quot;),
    log:
        bam=&quot;alignment/pbmm2_align/{sample}_{type}_{processing_unit}_{barcode}.bam.log&quot;,
    benchmark:
        repeat(
            &quot;alignment/pbmm2_align/{sample}_{type}_{processing_unit}_{barcode}.bam.benchmark.tsv&quot;,
            config.get(&quot;pbmm2_align&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;pbmm2_align&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;pbmm2_align&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;pbmm2_align&quot;, {}).get(&quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]),
        partition=config.get(&quot;pbmm2_align&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;pbmm2_align&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;pbmm2_align&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;pbmm2_align&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: Align reads in {input.query} against {input.reference}&quot;
    wrapper:
        &quot;v1.28.0/bio/pbmm2/align&quot;
</code></pre>
<h4 id="input-output-files_9"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="2" style="vertical-align:top;">input</td>
<td>reference</td>
<td><code>config.get("pbmm2_align", {}).get("index", "")</code></td>
<td>a mininmap2 index file for the reference genome</td>
</tr>
<tr>
<td>query</td>
<td><code>pbmm2_input</code></td>
<td>bam file with unaligned reads</td>
</tr>
<tr>
<td>output</td>
<td>bam</td>
<td><code>"alignment/pbmm2_align/{sample}_{type}_{processing_unit}_{barcode}.pbmm2.bam"</code></td>
<td>bam file with aligned reads (Note that the methylation tags will also be present in the aligned bam file)</td>
</tr>
</tbody>
</table>
<h3 id="configuration_9"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_9">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_9">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>max memory in MB to be available</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="picard-mark-duplicates"><a href="https://broadinstitute.github.io/picard/command-line-overview.html#MarkDuplicates">picard mark duplicates</a></h2>
<p>Generate a bam file for a single chromosome with duplicates marked</p>
<h3 id="rule_10"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule picard_mark_duplicates:
    input:
        bams=&quot;alignment/samtools_extract_reads/{sample}_{type}_{chr}.bam&quot;,
    output:
        bam=temp(&quot;alignment/picard_mark_duplicates/{sample}_{type}_{chr}.bam&quot;),
        metrics=temp(&quot;alignment/picard_mark_duplicates/{sample}_{type}_{chr}.metrics.txt&quot;),
    params:
        extra=config.get(&quot;picard_mark_duplicates&quot;, {}).get(&quot;extra&quot;, &quot;&quot;),
    log:
        &quot;alignment/picard_mark_duplicates/{sample}_{type}_{chr}.bam.log&quot;,
    benchmark:
        repeat(
            &quot;alignment/picard_mark_duplicates/{sample}_{type}_{chr}.bam.benchmark.tsv&quot;,
            config.get(&quot;picard_mark_duplicates&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;picard_mark_duplicates&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;picard_mark_duplicates&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;picard_mark_duplicates&quot;, {}).get(&quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]),
        partition=config.get(&quot;picard_mark_duplicates&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;picard_mark_duplicates&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;picard_mark_duplicates&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;picard_mark_duplicates&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: mark duplicates in {input} using picard&quot;
    wrapper:
        &quot;v1.25.0/bio/picard/markduplicates&quot;
</code></pre>
<h4 id="input-output-files_10"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>bams</td>
<td><code>"alignment/samtools_extract_reads/{sample}_{type}_{chr}.bam"</code></td>
<td>bam file containing one chromosome</td>
</tr>
<tr>
<td rowspan="2" style="vertical-align:top;">output</td>
<td>bam</td>
<td><code>"alignment/picard_mark_duplicates/{sample}_{type}_{chr}.bam"</code></td>
<td>duplicate marked bam file containing one chromosome</td>
</tr>
<tr>
<td>metrics</td>
<td><code>"alignment/picard_mark_duplicates/{sample}_{type}_{chr}.metrics.txt"</code></td>
<td>duplicate statistics for qc</td>
</tr>
</tbody>
</table>
<h3 id="configuration_10"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_10">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_10">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="picard_mark_duplicates_non_chr"><a href="https://broadinstitute.github.io/picard/command-line-overview.html#MarkDuplicates">picard_mark_duplicates_non_chr</a></h2>
<p>Generate a bam file for a non-chromosomal contigs and unmapped reads with duplicates marked</p>
<h3 id="rule_11"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule picard_mark_duplicates_non_chr:
    input:
        bams=&quot;alignment/samtools_extract_reads/{sample}_{type}_non_chr.bam&quot;,
    output:
        bam=temp(&quot;alignment/picard_mark_duplicates/{sample}_{type}_non_chr.bam&quot;),
        metrics=temp(&quot;alignment/picard_mark_duplicates/{sample}_{type}_non_chr.metrics.txt&quot;),
    params:
        extra=config.get(&quot;picard_mark_duplicates_non_chr&quot;, {}).get(&quot;extra&quot;, &quot;&quot;),
    log:
        &quot;alignment/picard_mark_duplicates_non_chr/{sample}_{type}.output.log&quot;,
    benchmark:
        repeat(
            &quot;alignment/picard_mark_duplicates_non_chr/{sample}_{type}.output.benchmark.tsv&quot;,
            config.get(&quot;picard_mark_duplicates_non_chr&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;picard_mark_duplicates_non_chr&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;picard_mark_duplicates_non_chr&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;picard_mark_duplicates_non_chr&quot;, {}).get(
            &quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]
        ),
        partition=config.get(&quot;picard_mark_duplicates_non_chr&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;picard_mark_duplicates_non_chr&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;picard_mark_duplicates_non_chr&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;picard_mark_duplicates&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: mark duplicates in {input.bams} using picard&quot;
    wrapper:
        &quot;v1.25.0/bio/picard/markduplicates&quot;
</code></pre>
<h4 id="input-output-files_11"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>bams</td>
<td><code>"alignment/samtools_extract_reads/{sample}_{type}_non_chr.bam"</code></td>
<td>bam file containing non-chromosomal contigs requested in the config and unmapped reads</td>
</tr>
<tr>
<td rowspan="2" style="vertical-align:top;">output</td>
<td>bam</td>
<td><code>"alignment/picard_mark_duplicates/{sample}_{type}_non_chr.bam"</code></td>
<td>duplicate marked bam file containing non-chromosomal contigs requested in the config and unmapped reads</td>
</tr>
<tr>
<td>metrics</td>
<td><code>"alignment/picard_mark_duplicates/{sample}_{type}_non_chr.metrics.txt"</code></td>
<td>duplicate statistics for qc</td>
</tr>
</tbody>
</table>
<h3 id="configuration_11"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_11">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_11">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="samtools_extract_reads"><a href="http://www.htslib.org/doc/samtools-view.html">samtools_extract_reads</a></h2>
<p>Extract reads from each chromosome and put into separate <code>.bam</code> files using samtools view.</p>
<h3 id="rule_12"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule samtools_extract_reads:
    input:
        bam=&quot;alignment/bwa_mem/{sample}_{type}.bam&quot;,
        bai=&quot;alignment/bwa_mem/{sample}_{type}.bam.bai&quot;,
    output:
        bam=temp(&quot;alignment/samtools_extract_reads/{sample}_{type}_{chr}.bam&quot;),
    params:
        extra=config.get(&quot;samtools_extract_reads&quot;, {}).get(&quot;extra&quot;, &quot;&quot;),
    log:
        &quot;alignment/samtools_extract_reads/{sample}_{type}_{chr}.bam.log&quot;,
    benchmark:
        repeat(
            &quot;alignment/samtools_extract_reads/{sample}_{type}_{chr}.bam.benchmark.tsv&quot;,
            config.get(&quot;samtools_extract_reads&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;samtools_extract_reads&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;samtools_extract_reads&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;samtools_extract_reads&quot;, {}).get(&quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]),
        partition=config.get(&quot;samtools_extract_reads&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;samtools_extract_reads&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;samtools_extract_reads&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;samtools_extract_reads&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: create bam {output} with only reads from {wildcards.chr}&quot;
    shell:
        &quot;(samtools view -@ {threads} {params.extra} -b {input} {wildcards.chr} &gt; {output}) &amp;&gt; {log}&quot;
</code></pre>
<h4 id="input-output-files_12"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="2" style="vertical-align:top;">input</td>
<td>bam</td>
<td><code>"alignment/bwa_mem/{sample}_{type}.bam"</code></td>
<td>bam file</td>
</tr>
<tr>
<td>bai</td>
<td><code>"alignment/bwa_mem/{sample}_{type}.bam.bai"</code></td>
<td>bam index file</td>
</tr>
<tr>
<td>output</td>
<td>bam</td>
<td><code>"alignment/samtools_extract_reads/{sample}_{type}_{chr}.bam"</code></td>
<td>one bam file for each chromosome</td>
</tr>
</tbody>
</table>
<h3 id="configuration_12"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_12">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_12">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="samtools_extract_reads_non_chr"><a href="http://www.htslib.org/doc/samtools-view.html">samtools_extract_reads_non_chr</a></h2>
<p>Extract reads from non-chromosomal contigs and unmapped reads to separate <code>.bam</code> files using samtools view.</p>
<h3 id="rule_13"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule samtools_extract_reads_non_chr:
    input:
        bam=&quot;alignment/bwa_mem/{sample}_{type}.bam&quot;,
        bai=&quot;alignment/bwa_mem/{sample}_{type}.bam.bai&quot;,
    output:
        bam=temp(&quot;alignment/samtools_extract_reads/{sample}_{type}_non_chr.bam&quot;),
    params:
        contigs=get_contig_list,
        extra=config.get(&quot;samtools_extract_reads_non_chr&quot;, {}).get(&quot;extra&quot;, &quot;&quot;),
    log:
        &quot;alignment/samtools_extract_reads/{sample}_{type}_non_chr.bam.log&quot;,
    benchmark:
        repeat(
            &quot;alignment/samtools_extract_reads/{sample}_{type}_non_chr.bam.benchmark.tsv&quot;,
            config.get(&quot;samtools_extract_reads_non_chr&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;samtools_extract_reads_non_chr&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;samtools_extract_reads_non_chr&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;samtools_extract_reads_non_chr&quot;, {}).get(
            &quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]
        ),
        partition=config.get(&quot;samtools_extract_reads_non_chr&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;samtools_extract_reads_non_chr&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;samtools_extract_reads_non_chr&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;samtools_extract_reads_non_chr&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: create bam {output} with only reads from {params.contigs}&quot;
    shell:
        &quot;(samtools view -@ {threads} {params.extra} -b {input} {params.contigs} '*' &gt; {output}) &amp;&gt; {log}&quot;
</code></pre>
<h4 id="input-output-files_13"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="2" style="vertical-align:top;">input</td>
<td>bam</td>
<td><code>"alignment/bwa_mem/{sample}_{type}.bam"</code></td>
<td>bam file</td>
</tr>
<tr>
<td>bai</td>
<td><code>"alignment/bwa_mem/{sample}_{type}.bam.bai"</code></td>
<td>bam index file</td>
</tr>
<tr>
<td>output</td>
<td>bam</td>
<td><code>"alignment/samtools_extract_reads/{sample}_{type}_non_chr.bam"</code></td>
<td>one bam file containing non-chromosomal contigs, requested using merged_contigs in config, and unmapped reads</td>
</tr>
</tbody>
</table>
<h3 id="configuration_13"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_13">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_13">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>max memory in MB to be available</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="samtools_extract_reads_umi"><a href="http://www.htslib.org/doc/samtools-view.html">samtools_extract_reads_umi</a></h2>
<p>Extract reads from each chromosome and put into separate <code>.bam</code> files using samtools view.</p>
<h3 id="rule_14"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule samtools_extract_reads_umi:
    input:
        bam=&quot;alignment/bwa_mem_realign_consensus_reads/{sample}_{type}.umi.bam&quot;,
        bai=&quot;alignment/bwa_mem_realign_consensus_reads/{sample}_{type}.umi.bam.bai&quot;,
    output:
        bam=temp(&quot;alignment/samtools_extract_reads_umi/{sample}_{type}_{chr}.umi.bam&quot;),
    params:
        extra=config.get(&quot;samtools_extract_reads&quot;, {}).get(&quot;extra&quot;, &quot;&quot;),
    log:
        &quot;alignment/samtools_extract_reads_umi/{sample}_{type}_{chr}.umi.bam.log&quot;,
    benchmark:
        repeat(
            &quot;alignment/samtools_extract_reads_umi/{sample}_{type}_{chr}.bam.benchmark.tsv&quot;,
            config.get(&quot;samtools_extract_reads_umi&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;samtools_extract_reads_umi&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;samtools_extract_reads_umi&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;samtools_extract_reads_umi&quot;, {}).get(&quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]),
        partition=config.get(&quot;samtools_extract_reads_umi&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;samtools_extract_reads_umi&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;samtools_extract_reads_umi&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;samtools_extract_reads_umi&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: create bam {output} with only reads from {wildcards.chr}&quot;
    shell:
        &quot;(samtools view -@ {threads} {params.extra} -b {input} {wildcards.chr} &gt; {output}) &amp;&gt; {log}&quot;
</code></pre>
<h4 id="input-output-files_14"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="2" style="vertical-align:top;">input</td>
<td>bam</td>
<td><code>"alignment/bwa_mem_realign_consensus_reads/{sample}_{type}.umi.bam"</code></td>
<td>bam file</td>
</tr>
<tr>
<td>bai</td>
<td><code>"alignment/bwa_mem_realign_consensus_reads/{sample}_{type}.umi.bam.bai"</code></td>
<td>bam index file</td>
</tr>
<tr>
<td>output</td>
<td>bam</td>
<td><code>"alignment/samtools_extract_reads_umi/{sample}_{type}_{chr}.umi.bam"</code></td>
<td>one bam file for each chromosome</td>
</tr>
</tbody>
</table>
<h3 id="configuration_14"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_14">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_14">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="samtools_extract_reads_non_chr_umi"><a href="http://www.htslib.org/doc/samtools-view.html">samtools_extract_reads_non_chr_umi</a></h2>
<p>Extract reads from contigs specified by merged_contigs and put into separate <code>.bam</code> files using samtools view.</p>
<h3 id="rule_15"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule samtools_extract_reads_non_chr_umi:
    input:
        bam=&quot;alignment/bwa_mem_realign_consensus_reads/{sample}_{type}.umi.bam&quot;,
        bai=&quot;alignment/bwa_mem_realign_consensus_reads/{sample}_{type}.umi.bam.bai&quot;,
    output:
        bam=temp(&quot;alignment/samtools_extract_reads/{sample}_{type}_non_chr.umi.bam&quot;),
    params:
        contigs=get_contig_list,
        extra=config.get(&quot;samtools_extract_reads_non_chr_umi&quot;, {}).get(&quot;extra&quot;, &quot;&quot;),
    log:
        &quot;alignment/samtools_extract_reads_non_chr_umi/{sample}_{type}_non_chr.umi.bam.log&quot;,
    benchmark:
        repeat(
            &quot;alignment/samtools_extract_reads_non_chr_umi/{sample}_{type}_non_chr.umi.bam.benchmark.tsv&quot;,
            config.get(&quot;samtools_extract_reads_non_chr_umi&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;samtools_extract_reads_non_chr_umi&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;samtools_extract_reads_non_chr_umi&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;samtools_extract_reads_non_chr_umi&quot;, {}).get(
            &quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]
        ),
        partition=config.get(&quot;samtools_extract_reads_non_chr_umi&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;samtools_extract_reads_non_chr_umi&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;samtools_extract_reads_non_chr_umi&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;samtools_extract_reads_non_chr_umi&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: create bam {output} with only reads from {params.contigs}&quot;
    shell:
        &quot;(samtools view -@ {threads} {params.extra} -b {input} {params.contigs} '*' &gt; {output}) &amp;&gt; {log}&quot;
</code></pre>
<h4 id="input-output-files_15"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="2" style="vertical-align:top;">input</td>
<td>bam</td>
<td><code>"alignment/bwa_mem_realign_consensus_reads/{sample}_{type}.umi.bam"</code></td>
<td>bam file</td>
</tr>
<tr>
<td>bai</td>
<td><code>"alignment/bwa_mem_realign_consensus_reads/{sample}_{type}.umi.bam.bai"</code></td>
<td>bam index file</td>
</tr>
<tr>
<td>output</td>
<td>bam</td>
<td><code>"alignment/samtools_extract_reads/{sample}_{type}_non_chr.umi.bam"</code></td>
<td>one bam file containing non-chromosomal contigs, requested using merged_contigs in config, and unmapped reads</td>
</tr>
</tbody>
</table>
<h3 id="configuration_15"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_15">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_15">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>max memory in MB to be available</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="samtools_fastq"><a href="http://www.htslib.org/doc/samtools-fasta.html">samtools_fastq</a></h2>
<p>Converts a bam file to separate fastq files</p>
<h3 id="rule_16"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule samtools_fastq:
    input:
        bam=&quot;alignment/fgbio_call_and_filter_consensus_reads/{sample}_{type}.umi.unmapped_bam&quot;,
    output:
        fastq1=&quot;alignment/samtools_fastq/{sample}_{type}.fastq1.umi.fastq.gz&quot;,
        fastq2=&quot;alignment/samtools_fastq/{sample}_{type}.fastq2.umi.fastq.gz&quot;,
    params:
        sort=config.get(&quot;samtools_fastq&quot;, {}).get(&quot;sort&quot;, &quot;-m 4G&quot;),
        fastq=config.get(&quot;samtools_fastq&quot;, {}).get(&quot;fastq&quot;, &quot;-n&quot;),
    log:
        &quot;alignment/samtools_fastq/{sample}_{type}.output.log&quot;,
    benchmark:
        repeat(
            &quot;alignment/samtools_fastq/{sample}_{type}.output.benchmark.tsv&quot;,
            config.get(&quot;samtools_fastq&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;samtools_fastq&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;samtools_fastq&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;samtools_fastq&quot;, {}).get(&quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]),
        partition=config.get(&quot;samtools_fastq&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;samtools_fastq&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;samtools_fastq&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;samtools_fastq&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: Convert the bam file {input.bam} into a fastq file&quot;
    wrapper:
        &quot;v2.6.0/bio/samtools/fastq/separate&quot;
</code></pre>
<h4 id="input-output-files_16"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>bam</td>
<td><code>"alignment/fgbio_call_and_filter_consensus_reads/{sample}_{type}.umi.unmapped_bam"</code></td>
<td>input bam file</td>
</tr>
<tr>
<td rowspan="2" style="vertical-align:top;">output</td>
<td>fastq1</td>
<td><code>"alignment/samtools_fastq/{sample}_{type}.fastq1.umi.fastq.gz"</code></td>
<td>fastq file with the first read in the read pair</td>
</tr>
<tr>
<td>fastq2</td>
<td><code>"alignment/samtools_fastq/{sample}_{type}.fastq2.umi.fastq.gz"</code></td>
<td>fastq file with the second read in the read pair</td>
</tr>
</tbody>
</table>
<h3 id="configuration_16"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_16">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>sort</td>
<td>string</td>
<td>parameters that should be forwarded to samtools sort</td>
</tr>
<tr>
<td>fastq</td>
<td>string</td>
<td>parameters that should be forwarded to samtools fastq</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_16">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>max memory in MB to be available</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory used per cpu<br /><strong>NOTE:</strong> should be at least the amount put into the sort parameters<br /></td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available<br /><strong>RECOMMENDATION:</strong> use at least 3 threads so that sort gets at least 1 exclusive thread<br /><strong>NOTE:</strong> if multiple threads is used the memory must also be increased (mem_mb)<br /></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="samtools-index"><a href="http://www.htslib.org/doc/samtools-index.html">samtools index</a></h2>
<p>Index <code>.bam</code> files using samtools index.</p>
<h3 id="rule_17"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule samtools_index:
    input:
        bam=&quot;{file}.bam&quot;,
    output:
        bai=temp(&quot;{file}.bam.bai&quot;),
    params:
        extra=config.get(&quot;samtools_index&quot;, {}).get(&quot;extra&quot;, &quot;&quot;),
    log:
        &quot;{file}.bam.bai.log&quot;,
    benchmark:
        repeat(
            &quot;{file}.bam.bai.benchmark.tsv&quot;,
            config.get(&quot;samtools_index&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    container:
        config.get(&quot;samtools_index&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    threads: config.get(&quot;samtools_index&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;samtools_index&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;samtools_index&quot;, {}).get(&quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]),
        partition=config.get(&quot;samtools_index&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;samtools_index&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;samtools_index&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    message:
        &quot;{rule}: create index for {input.bam}&quot;
    wrapper:
        &quot;v1.1.0/bio/samtools/index&quot;
</code></pre>
<h4 id="input-output-files_17"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>bam</td>
<td><code>"{file}.bam"</code></td>
<td>bam file</td>
</tr>
<tr>
<td>output</td>
<td>bai</td>
<td><code>"{file}.bam.bai"</code></td>
<td>bam index file</td>
</tr>
</tbody>
</table>
<h3 id="configuration_17"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_17">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_17">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="samtools_merge_bam"><a href="http://www.htslib.org/doc/samtools-merge.html">samtools_merge_bam</a></h2>
<p>Merge <code>.bam</code> files from the same sample using samtools merge.</p>
<h3 id="rule_18"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule samtools_merge_bam:
    input:
        bams=get_chrom_bams,
        non_chr_bams=&quot;alignment/picard_mark_duplicates/{sample}_{type}_non_chr.bam&quot;
        if config.get(&quot;reference&quot;, {}).get(&quot;merge_contigs&quot;, None) is not None
        else [],
    output:
        bam=temp(&quot;alignment/samtools_merge_bam/{sample}_{type}_unsorted.bam&quot;),
    params:
        extra=config.get(&quot;samtools_merge_bam&quot;, {}).get(&quot;extra&quot;, &quot;&quot;),
    log:
        &quot;alignment/samtools_merge_bam/{sample}_{type}_unsorted.bam.log&quot;,
    benchmark:
        repeat(
            &quot;alignment/samtools_merge_bam/{sample}_{type}_unsorted.bam.benchmark.tsv&quot;,
            config.get(&quot;samtools_merge_bam&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;samtools_merge_bam&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;samtools_merge_bam&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;samtools_merge_bam&quot;, {}).get(&quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]),
        partition=config.get(&quot;samtools_merge_bam&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;samtools_merge_bam&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;samtools_merge_bam&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;samtools&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: merge chr bam files, creating {output}&quot;
    wrapper:
        &quot;v1.1.0/bio/samtools/merge&quot;
</code></pre>
<h4 id="input-output-files_18"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>bams</td>
<td><code>get_chrom_bams</code></td>
<td>list of bam files for all the chromosomes<br />the list is generated by the function extract_chr defined in the <a href="https://github.com/hydra-genetics/hydra-genetics/blob/develop/hydra_genetics/utils/misc.py">hydra-genetics</a> module<br /></td>
</tr>
<tr>
<td>output</td>
<td>bam</td>
<td><code>"alignment/samtools_merge_bam/{sample}_{type}_unsorted.bam"</code></td>
<td>merged unsorted bam file</td>
</tr>
</tbody>
</table>
<h3 id="configuration_18"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_18">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded<br />RECOMMENDED: use -c -p to only keep one of the read groups IDs when merging files from the same sample<br /></td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_18">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="samtools-sort"><a href="http://www.htslib.org/doc/samtools-sort.html">samtools sort</a></h2>
<p>Sort <code>.bam</code> files using samtools sort.</p>
<h3 id="rule_19"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule samtools_sort:
    input:
        bam=&quot;{file}_unsorted.bam&quot;,
    output:
        bam=temp(&quot;{file}.bam&quot;),
    params:
        extra=config.get(&quot;samtools_sort&quot;, {}).get(&quot;extra&quot;, &quot;&quot;),
    log:
        &quot;{file}.bam.sort.log&quot;,
    benchmark:
        repeat(
            &quot;{file}.bam.sort.benchmark.tsv&quot;,
            config.get(&quot;samtools_sort&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;samtools_sort&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;samtools_sort&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;samtools_sort&quot;, {}).get(&quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]),
        partition=config.get(&quot;samtools_sort&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;samtools_sort&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;samtools_sort&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;samtools_sort&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: sort bam file {input.bam} using samtools&quot;
    wrapper:
        &quot;v1.3.2/bio/samtools/sort&quot;
</code></pre>
<h4 id="input-output-files_19"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>bam</td>
<td><code>"{file}_unsorted.bam"</code></td>
<td>unsorted bam file</td>
</tr>
<tr>
<td>output</td>
<td>bam</td>
<td><code>"{file}.bam"</code></td>
<td>sorted bam file</td>
</tr>
</tbody>
</table>
<h3 id="configuration_19"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_19">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_19">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="samtools-sort_umi"><a href="http://www.htslib.org/doc/samtools-sort.html">samtools sort_umi</a></h2>
<p>Sort <code>.bam</code> files using samtools sort. Sort on query name.</p>
<h3 id="rule_20"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule samtools_sort:
    input:
        bam=&quot;{file}_unsorted.bam&quot;,
    output:
        bam=temp(&quot;{file}.bam&quot;),
    params:
        extra=config.get(&quot;samtools_sort&quot;, {}).get(&quot;extra&quot;, &quot;&quot;),
    log:
        &quot;{file}.bam.sort.log&quot;,
    benchmark:
        repeat(
            &quot;{file}.bam.sort.benchmark.tsv&quot;,
            config.get(&quot;samtools_sort&quot;, {}).get(&quot;benchmark_repeats&quot;, 1),
        )
    threads: config.get(&quot;samtools_sort&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;samtools_sort&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;samtools_sort&quot;, {}).get(&quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]),
        partition=config.get(&quot;samtools_sort&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;samtools_sort&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;samtools_sort&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;samtools_sort&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: sort bam file {input.bam} using samtools&quot;
    wrapper:
        &quot;v1.3.2/bio/samtools/sort&quot;
</code></pre>
<h4 id="input-output-files_20"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>bam</td>
<td><code>"{file}_unsorted.bam"</code></td>
<td>unsorted bam file</td>
</tr>
<tr>
<td>output</td>
<td>bam</td>
<td><code>"{file}.bam"</code></td>
<td>sorted bam file</td>
</tr>
</tbody>
</table>
<h3 id="configuration_20"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_20">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_20">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="star"><a href="https://github.com/alexdobin/STAR">star</a></h2>
<p>Align <code>.fastq</code> files to a reference genome and generate a <code>.bam</code> file. Star is a split read aware aligner for RNA-data.</p>
<h3 id="rule_21"><img alt="🐍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f40d.svg" title=":snake:" /> Rule</h3>
<pre><code>rule star:
    input:
        fq1=&quot;prealignment/merged/{sample}_{type}_fastq1.fastq.gz&quot;,
        fq2=&quot;prealignment/merged/{sample}_{type}_fastq2.fastq.gz&quot;,
        idx=config.get(&quot;star&quot;, {}).get(&quot;genome_index&quot;, &quot;&quot;),
    output:
        bam=temp(&quot;alignment/star/{sample}_{type}.bam&quot;),
        sj=temp(&quot;alignment/star/{sample}_{type}.SJ.out.tab&quot;),
    params:
        extra=config.get(&quot;star&quot;, {}).get(&quot;extra&quot;, &quot;--outSAMtype BAM SortedByCoordinate&quot;),
        idx=&quot;{input.idx}&quot;,
    log:
        &quot;alignment/star/{sample}_{type}.bam.log&quot;,
    benchmark:
        repeat(&quot;alignment/star/{sample}_{type}.bam.benchmark.tsv&quot;, config.get(&quot;star&quot;, {}).get(&quot;benchmark_repeats&quot;, 1))
    threads: config.get(&quot;star&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;])
    resources:
        mem_mb=config.get(&quot;star&quot;, {}).get(&quot;mem_mb&quot;, config[&quot;default_resources&quot;][&quot;mem_mb&quot;]),
        mem_per_cpu=config.get(&quot;star&quot;, {}).get(&quot;mem_per_cpu&quot;, config[&quot;default_resources&quot;][&quot;mem_per_cpu&quot;]),
        partition=config.get(&quot;star&quot;, {}).get(&quot;partition&quot;, config[&quot;default_resources&quot;][&quot;partition&quot;]),
        threads=config.get(&quot;star&quot;, {}).get(&quot;threads&quot;, config[&quot;default_resources&quot;][&quot;threads&quot;]),
        time=config.get(&quot;star&quot;, {}).get(&quot;time&quot;, config[&quot;default_resources&quot;][&quot;time&quot;]),
    container:
        config.get(&quot;star&quot;, {}).get(&quot;container&quot;, config[&quot;default_container&quot;])
    message:
        &quot;{rule}: align with star, creating {output.bam}&quot;
    wrapper:
        &quot;v1.3.2/bio/star/align&quot;
</code></pre>
<h4 id="input-output-files_21"><img alt="↔" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2194.svg" title=":left_right_arrow:" /> input / output files</h4>
<table>
<thead>
<tr>
<th>Rule parameters</th>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="3" style="vertical-align:top;">input</td>
<td>fq1</td>
<td><code>"prealignment/merged/{sample}_{type}_fastq1.fastq.gz"</code></td>
<td>merged fastq file from read 1</td>
</tr>
<tr>
<td>fq2</td>
<td><code>"prealignment/merged/{sample}_{type}_fastq2.fastq.gz"</code></td>
<td>merged fastq file from read 2</td>
</tr>
<tr>
<td>idx</td>
<td><code>config.get("star", {}).get("genome_index", "")</code></td>
<td>star reference genome index<br />file location is set in <code>config.yaml</code><br /></td>
</tr>
<tr>
<td rowspan="2" style="vertical-align:top;">output</td>
<td>bam</td>
<td><code>"alignment/star/{sample}_{type}.bam"</code></td>
<td>aligned bam file</td>
</tr>
<tr>
<td>sj</td>
<td><code>"alignment/star/{sample}_{type}.SJ.out.tab"</code></td>
<td>junction file with split read information useful for interpreting rna data</td>
</tr>
</tbody>
</table>
<h3 id="configuration_21"><img alt="🔧" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/1f527.svg" title=":wrench:" /> Configuration</h3>
<h4 id="software-settings-configyaml_21">Software settings (<code>config.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>benchmark_repeats</td>
<td>integer</td>
<td>set number of times benchmark should be repeated</td>
</tr>
<tr>
<td>container</td>
<td>string</td>
<td>name or path to docker/singularity container</td>
</tr>
<tr>
<td>extra</td>
<td>string</td>
<td>parameters that should be forwarded<br /><strong>RECOMMENDATION:</strong> --outSAMtype BAM SortedByCoordinate<br />this will output coordinate sorted bam files instead of a sam file<br /></td>
</tr>
<tr>
<td>genome_index</td>
<td>string</td>
<td>path to star reference index</td>
</tr>
</tbody>
</table>
<h4 id="resources-settings-resourcesyaml_21">Resources settings (<code>resources.yaml</code>)</h4>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>mem_mb</td>
<td>integer</td>
<td>memory in MB used per cpu</td>
</tr>
<tr>
<td>mem_per_cpu</td>
<td>integer</td>
<td>memory used per cpu</td>
</tr>
<tr>
<td>partition</td>
<td>string</td>
<td>partition to use on cluster</td>
</tr>
<tr>
<td>time</td>
<td>string</td>
<td>max execution time</td>
</tr>
<tr>
<td>threads</td>
<td>integer</td>
<td>number of threads to be available<br /><strong>RECOMMENDATION:</strong> use multiple threads for decreased run time.<br /><strong>NOTE:</strong> if multiple threads is used the memory must also be increased (mem_mb)<br /></td>
</tr>
</tbody>
</table>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../intro/" class="btn btn-neutral float-left" title="Introduction"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../intro/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
