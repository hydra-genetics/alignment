$schema: "http://json-schema.org/draft-04/schema#"
description: snakemake configuration file
type: object
properties:
  resources:
    type: string
    description: path to resources.yaml file

  samples:
    type: string
    description: path to samples.tsv file

  units:
    type: string
    description: path to units.tsv file

  default_container:
    type: string
    description: name or path to a default docker/singularity container

  reference:
    type: object
    description: reference used by alignment
    properties:
      fasta:
        type: string
        description: fasta reference file
      fai:
        type: string
        description: fasta reference fai file
      skip_chrs:
        type: array
        items:
            type: string
        description: list of chromosomes that should be skipped, used when determining which chr bam files will be merged

  bwa_mem:
    type: object
    description: parameters for bwa mem
    properties:
      benchmark_repeats:
        type: integer
        description: set number of times benchmark should be repeated
      container:
        type: string
        description: name or path to docker/singularity container
      extra:
        type: string
        description: parameters that should be forwarded
      read_group:
        type: string
        description: |
          RG string will be added to bam file generated.
          The RG string is generated by the function alignment_input defined in [`common.smk`](https://github.com/hydra-genetics/prealignment/blob/develop/workflow/rules/common.smk)
      umi:
        type: string
        description: | 
          NOTE: set this flag to **-Y** when using umis to call consensus reads using fgbio
      sorting:
        type: string
        description: program handling the bam sorting (default samtools)
      sort_order:
        type: string
        description: how the bam file should be sorted (default coordinate)
      sort_extra:
        type: string
        description: parameters that should be forwarded to sorting (ie, number of threads)
      amb:
        type: string
        description: fasta reference amb file
      ann:
        type: string
        description: fasta reference ann file
      bwt:
        type: string
        description: fasta reference bwt file
      pac:
        type: string
        description: fasta reference pac file
      sa:
        type: string
        description: fasta reference sa file
    required:
      - amb
      - ann
      - bwt
      - pac
      - sa

  bwa_mem_merge:
    type: object
    description: parameters for merging of bam files, directly after alignment step
    properties:
      benchmark_repeats:
        type: integer
        description: set number of times benchmark should be repeated
      container:
        type: string
        description: name or path to docker/singularity container
      extra:
        type: string
        description: |
          parameters that should be forwarded
          RECOMMENDATION: use -c -p to only keep one of the read groups IDs when merging files from the same sample

  bwa_mem_realign_consensus_reads:
    type: object
    description: parameters for bwa_mem_realign_consensus_reads
    properties:
      benchmark_repeats:
        type: integer
        description: set number of times benchmark should be repeated
      container:
        type: string
        description: name or path to docker/singularity container
      extra_bwa_mem:
        type: string
        description: parameters that should be forwarded to bwa_mem
      extra_sort:
        type: string
        description: parameters that should be forwarded to samtools sort
      extra_zipper_bam:
        type: string
        description: parameters that should be forwarded to fgbios ZipperBam

  fgbio_call_and_filter_consensus_reads:
    type: object
    description: parameters for fgbio_call_and_filter_consensus_reads
    properties:
      benchmark_repeats:
        type: integer
        description: set number of times benchmark should be repeated
      container:
        type: string
        description: name or path to docker/singularity container
      extra_call:
        type: string
        description: parameters that should be forwarded to CallMolecularConsensusReads
      extra_filter:
        type: string
        description: parameters that should be forwarded to FilterConsensusReads
      max_base_error_rate:
        type: string
        description: mask bases with N if the % of reads that differ from consensus in higher than max error rate in FilterConsensusReads
      min_reads_call:
        type: string
        description: filter if under minimum number of reads with the same umi in CallMolecularConsensusReads
      min_reads_filter:
        type: string
        description: filter if under minimum number of reads with the same umi in FilterConsensusReads
      min_input_base_quality_call:
        type: string
        description: only consider bases over min base quality in consensus creation in CallMolecularConsensusReads
      min_input_base_quality_filter:
        type: string
        description: mask bases with N if under min base quality in consensus creation in FilterConsensusReads

  fgbio_copy_umi_from_read_name:
    type: object
    description: parameters for fgbio_copy_umi_from_read_name
    properties:
      benchmark_repeats:
        type: integer
        description: set number of times benchmark should be repeated
      container:
        type: string
        description: name or path to docker/singularity container
      extra:
        type: string
        description: parameters that should be forwarded

  picard_mark_duplicates:
    type: object
    description: mark duplicates settings
    properties:
      benchmark_repeats:
        type: integer
        description: set number of times benchmark should be repeated
      container:
        type: string
        description: name or path to docker/singularity container
      extra:
        type: string
        description: parameters that should be forwarded

  samtools_extract_reads:
    type: object
    description: parameters used when extracting reads
    properties:
      benchmark_repeats:
        type: integer
        description: set number of times benchmark should be repeated
      container:
        type: string
        description: name or path to docker/singularity container
      extra:
        type: string
        description: parameters that should be forwarded

  samtools_index:
    type: object
    description: parameters for indexing a bam file
    properties:
      benchmark_repeats:
        type: integer
        description: set number of times benchmark should be repeated
      container:
        type: string
        description: name or path to docker/singularity container
      extra:
        type: string
        description: parameters that should be forwarded

  samtools_merge_bam:
    type: object
    description: parameters for merging  bam files
    properties:
      benchmark_repeats:
        type: integer
        description: set number of times benchmark should be repeated
      container:
        type: string
        description: name or path to docker/singularity container
      extra:
        type: string
        description: |
          parameters that should be forwarded
          RECOMMENDED: use -c -p to only keep one of the read groups IDs when merging files from the same sample

  samtools_sort:
    type: object
    description: parameters for sorting bam files
    properties:
      benchmark_repeats:
        type: integer
        description: set number of times benchmark should be repeated
      container:
        type: string
        description: name or path to docker/singularity container
      extra:
        type: string
        description: parameters that should be forwarded

  star:
    type: object
    description: parameters for alignment with star
    properties:
      benchmark_repeats:
        type: integer
        description: set number of times benchmark should be repeated
      container:
        type: string
        description: name or path to docker/singularity container
      extra:
        type: string
        description: |
          parameters that should be forwarded
          RECOMMENDATION: --outSAMtype BAM SortedByCoordinate
          This will output coordinate sorted bam files instead of a sam file
      genome_index:
        type: string
        description: path to star reference index
    required:
      - genome_index

  trimmer_software:
    type: string
    description: Set input files for alignment software, if "None" is set the files in units.tsv will be used. Default is None.
    pattern: "^(fastp_pe|merged|None)$"

required:
  - samples
  - units
  - default_container
